"use strict";export default class Reflex{constructor(t){this.state=t.state,this.observer={},this.define(t.elements)}get(t){return t.split(".").reduce((t,e)=>t?t[e]:"",this.state)}set(t,e,s=null,i=this.state){if(s||(s=t.split(".")),s.length>1)this.set(t,e,s.slice(1),i[s[0]]);else if(e!==i[s[0]]){const r=i[s[0]];i[s[0]]=e,this.runObserver(t,e,r)}}observe(t,e,s={}){this.observer[t]||(this.observer[t]=[]),this.observer[t].push(e),s.immediate&&e(this.get(t))}runObserver(t,e,s){this.observer[t]&&this.observer[t].forEach(t=>t(e,s))}define(t){const e=this;t.forEach(t=>{customElements.define(`reflex-${t}`,class extends document.createElement(t).constructor{constructor(){super(),this.reflex=e}connectedCallback(){if(this.bindAttributes=Array.from(this.attributes).filter(({name:t})=>t.startsWith(":")||"for"===t||"if"===t||"text"===t||"html"===t),this.hasAttribute("for")){const[t,e]=this.getAttribute("for").split(" in ");this.removeAttribute("for"),this.setAttribute("_for",`${t} in ${e}`),this.orginalNode=this.cloneNode(!0),this.setAttribute("for",`${t} in ${e}`),this.removeAttribute("_for")}this._setPaths(),this.render()}render(){this.bindAttributes.forEach(({name:t})=>{const e=this.path[t.replace(":","")],s=e.startsWith("#")?this.closest(`[for^="${e.replace("#","")} in "], `+`[_for^="${e.replace("#","")} in "]`)._index:this.reflex.get(e);if("for"===t||"_for"===t){for(this._index=0,this._renderChilds(this);this.nextSibling._index>0;)this.nextSibling.remove();if(s.length>0&&this.orginalNode){this.hidden=!1;for(let t=s.length-1;t>0;t--){const e=this.orginalNode.cloneNode(!0);e._index=t,this.after(e),this._renderChilds(e)}}else this.hidden=!0}else if("if"===t){const t=s,e=this.getAttribute("if").split(" ")[2],i=this.getAttribute("if").split(" ")[1];this.hidden=!(!e&&!i&&t||"=="===i&&t==e||"!="===i&&t!=e||"<"===i&&t<e||">"===i&&t>e||"<="===i&&t<=e||">="===i&&t>=e)}else"text"===t&&this.textContent!==s?this.textContent=s:"html"===t&&this.innerHTML!==s?this.innerHTML=s:t.startsWith(":")&&this.setAttribute(t.slice(1),s);":value"===t&&this.value!==s&&(this.value=s)})}_renderChilds(t){t.querySelectorAll("[is^='reflex-'").forEach(t=>t.render&&t.render())}_setPaths(){this.path={},this.bindAttributes.forEach(({name:t,value:e})=>{"for"!==t&&"_for"!==t||(e=e.split(" in ")[1]),"if"===t&&(e=e.split(" ")[0]);const s=(t,e=[])=>{const i=t.parentNode&&t.parentNode.closest("[for], [_for]");return i?(e.push(i),s(i,e)):e},i=s(this);(this.hasAttribute("for")||this.hasAttribute("_for"))&&i.unshift(this),i.forEach(t=>{const s=t._index,[i,r]=t.hasAttribute("for")?t.getAttribute("for").split(" in "):t.getAttribute("_for").split(" in ");e=e.replace(new RegExp(`(^|\\.)${i}(\\.|$)`),`$1${r}.${s}$2`)}),this.path[t.replace(":","")]=e,this.reflex.observe(e,this.render.bind(this))})}},{extends:t})})}}