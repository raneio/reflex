"use strict";export default class{constructor(t){this.state=t.state,this.observer={},this.define(t.elements),Object.entries(t.watch).forEach(([t,e])=>{this.observe(t,e)})}get(t,e){return t.split(".").reduce((t,s)=>t?"function"==typeof t[s]?t[s]({...this,observe:this.observe.bind({...this,node:e})}):t[s]:"",this.state)}set(t,e,s=null,r=this.state){s?s.length>1?this.set(t,e,s.slice(1),r[s[0]]):(r[s[0]]=e,this.runObserver(t)):this.set(t,e,t.split("."),r)}observe(t,e){this.observer[t]||(this.observer[t]=[]),e&&!this.observer[t].includes(e)?this.observer[t].push(e):this.node&&!this.observer[t].includes(this.node)&&this.observer[t].push(this.node)}runObserver(t){this.observer[t]&&this.observer[t].forEach(t=>{"function"==typeof t.render?t.render():t(this)})}define(t){const e=this;t.forEach(t=>{customElements.define(`reflex-${t}`,class extends document.createElement(t).constructor{constructor(){super()}connectedCallback(){if(this.hasAttribute("for")){const[t,e]=this.getAttribute("for").split(" in ");this.removeAttribute("for"),this.setAttribute("_for",`${t} in ${e}`),this.orginalNode=this.cloneNode(!0),this.setAttribute("for",`${t} in ${e}`),this.removeAttribute("_for")}this.render()}render(){Array.from(this.attributes).filter(({name:t})=>t.startsWith(":")||"for"===t||"text"===t||"html"===t).forEach(({name:t,value:s})=>{const r=this._getPath(t,s),i=e.get(r,this);if("for"===t||"_for"===t){for(this._renderChilds(this);this.nextSibling._index>0;)this.nextSibling.remove();if(i.length>0&&this.orginalNode){this.hidden=!1;for(let t=i.length-1;t>0;t--){const e=this.orginalNode.cloneNode(!0);e._index=t,this.after(e),this._renderChilds(e)}}else this.hidden=!0}else"text"===t&&this.textContent!==i?this.textContent=i:"html"===t&&this.innerHTML!==i?this.innerHTML=i:":value"===t&&this.value!==i?this.value=i:t.startsWith(":")&&this.setAttribute(t.slice(1),i);":value"!==t&&"text"!==t&&"html"!==t||(this.path=r),e.observe.bind({...e,node:this})(r)})}_getPath(t,e){let s="for"===t||"_for"===t?e.split(" in ")[1]:e;const r=(t,e=[])=>{const s=t.parentNode&&t.parentNode.closest("[for], [_for]");return s?(e.push(s),r(s,e)):e},i=r(this);return(this.hasAttribute("for")||this.hasAttribute("_for"))&&i.unshift(this),i.forEach(t=>{const e=t._index||0,[r,i]=t.hasAttribute("for")?t.getAttribute("for").split(" in "):t.getAttribute("_for").split(" in ");s=s.replace(new RegExp(`(^|\\.)${r}(\\.)`),`$1${i}.${e}$2`)}),s}_renderChilds(t){t.querySelectorAll("[is^='reflex-'").forEach(t=>t.render&&t.render())}},{extends:t})})}}