"use strict";export default class{constructor(e){this.state=e.state,this.observer={},this.define(e.elements),Object.entries(e.watch).forEach(([e,t])=>{this.observe(e,t)})}get(e,t){const s=e.split(".").reduce((e,t)=>e[t]||"",this.state);return"function"==typeof s?s({...this,observe:this.observe.bind({...this,node:t})}):s}set(e,t,s=null,i=this.state){s?s.length>1?this.set(e,t,s.slice(1),i[s[0]]):(i[s[0]]=t,this.observer[e].forEach(e=>{"function"==typeof e.render?e.render():e(this)})):this.set(e,t,e.split("."),i)}observe(e,t){this.observer[e]||(this.observer[e]=[]),t&&!this.observer[e].includes(t)?this.observer[e].push(t):this.node&&!this.observer[e].includes(this.node)&&this.observer[e].push(this.node)}define(e){const t=this;e.forEach(e=>{customElements.define(`reflex-${e}`,class extends document.createElement(e).constructor{constructor(){super()}connectedCallback(){if(this.hasAttribute(":for")){const[e,t]=this.getAttribute(":for").split(" in ");this.removeAttribute(":for"),this.setAttribute("_for",`${e} in ${t}`),this.orginalNode=this.cloneNode(!0),this.setAttribute(":for",`${e} in ${t}`),this.removeAttribute("_for")}this.render()}render(){Array.from(this.attributes).filter(({name:e})=>e.startsWith(":")).forEach(({name:e,value:s})=>{const i=this._getParents("[\\:for], [_for]",this);if((this.hasAttribute(":for")||this.hasAttribute("_for"))&&i.unshift(this),i.forEach(e=>{const t=e._index||0,[i,r]=e.hasAttribute(":for")?e.getAttribute(":for").split(" in "):e.getAttribute("_for").split(" in ");s=s.replace(new RegExp(`(^|\\.| in )${i}(\\.|$)`),`$1${r}.${t}$2`)}),":value"===e&&(this.path=s),":for"===e||"_for"===e){const e=s.split(" in ")[1],i=t.get(e).length-1;for(t.observe.bind({...t,node:this})(e),this._renderChilds(this);this.nextSibling._index>0;)this.nextSibling.remove();if(i>=0&&this.orginalNode){this.hidden=!1;for(let s=i;s>0;s--){const i=this.orginalNode.cloneNode(!0);i._index=s,t.observe.bind({...t,node:i})(e),this.after(i),this._renderChilds(i)}}else this.hidden=!0}else if(e.startsWith(":")){t.observe.bind({...t,node:this})(s);const i=e.slice(1).replace(/(^|-)(html|dom|uri)/,(e,t,s)=>`${s}`.toUpperCase()).replace(/-(.)/g,(e,t)=>t.toUpperCase());void 0!==typeof this[i]?this[i]=t.get(s,this):this.setAttribute(e.slice(1),t.get(s,this))}})}_getParents(e,t,s=[]){const i=t.parentNode&&t.parentNode.closest(e);return i?(s.push(i),this._getParents(e,i,s)):s}_renderChilds(e){e.querySelectorAll("[is^='reflex-'").forEach(e=>e.render&&e.render())}},{extends:e})})}}